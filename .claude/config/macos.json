{
  "platform": "macos",
  "example_ron_path": "~/Library/Application Support/restore_window/windows.ron",
  "test_ron_dir": ".claude/config/ron/macos",

  "tests": [
    {
      "id": "same_monitor_restore_mon0",
      "description": "Basic position/size persistence on Monitor 0",
      "automation": "full",
      "launch_monitor": 0,

      "ron_file": "same_monitor_restore_mon0.ron",

      "mutation": {
        "target_monitor": "launch",
        "position_offset": [400, 300],
        "size": [1000, 700]
      },

      "validate": ["position", "size", "monitor_index", "mode"]
    },

    {
      "id": "cross_high_to_low_W1",
      "description": "Window on low-DPI monitor restores correctly when launched from high-DPI monitor",
      "automation": "full",
      "launch_monitor": 0,
      "requires": {"min_monitors": 2, "different_scales": true},
      "workaround_keys": ["W1"],

      "workaround_validation": {
        "feature_flag": "workaround-macos-scale-compensation",
        "build_without": "--no-default-features --features workaround-winit-4341,workaround-bevy-22060",
        "build_with": "",
        "without_behavior": "Window restores to wrong position/size on Monitor 1 due to scale factor mismatch",
        "with_behavior": "Window restores to correct position/size on Monitor 1"
      },

      "ron_file": "cross_monitor_high_to_low.ron",

      "validate": ["position", "size", "monitor_index", "mode"]
    },

    {
      "id": "borderless_programmatic_mon0",
      "description": "Borderless fullscreen restore - starts in borderless mode via RON",
      "automation": "full",
      "launch_monitor": 0,

      "ron_file": "fullscreen_borderless_mon0.ron",

      "validate": ["monitor_index", "mode"]
    },

    {
      "id": "exclusive_quit_B1",
      "description": "Exclusive fullscreen with TLS panic workaround - tests that app quits cleanly from exclusive fullscreen",
      "automation": "full",
      "launch_monitor": 0,
      "workaround_keys": ["B1"],

      "workaround_validation": {
        "feature_flag": "workaround-bevy-22060",
        "build_without": "--no-default-features --features workaround-winit-4341,workaround-macos-scale-compensation,workaround-macos-drag-back-reset",
        "build_with": "",
        "without_behavior": "App panics on quit (exit code 134) with TLS error",
        "with_behavior": "App quits cleanly (exit code 0)"
      },

      "ron_file": "fullscreen_exclusive_mon0.ron",

      "quit_method": "osascript_cmd_q",
      "validate": ["exit_code"]
    },

    {
      "id": "borderless_green_button",
      "description": "Tests macOS native fullscreen via green button (automated via AppleScript)",
      "automation": "full",
      "launch_monitor": 0,

      "ron_file": "fullscreen_borderless_green_button.ron",

      "click_fullscreen_button": true,
      "expected_mode": "BorderlessFullscreen",
      "validate": ["mode"]
    },

    {
      "id": "dpi_drag_stability_W4",
      "description": "Tests AppKit per-scale size tracking bug - window size should not reset when dragging between monitors",
      "automation": "human_assisted",
      "launch_monitor": 0,
      "requires": {"min_monitors": 2, "different_scales": true},
      "workaround_keys": ["W4"],

      "workaround_validation": {
        "feature_flag": "workaround-macos-drag-back-reset",
        "build_without": "--no-default-features --features workaround-winit-4341,workaround-bevy-22060,workaround-macos-scale-compensation",
        "build_with": "",
        "without_behavior": "Window size shrinks incorrectly when dragged from Monitor 1 back to Monitor 0",
        "with_behavior": "Window size is preserved when dragged back (brief visual flash is expected)"
      },

      "ron_file": "dpi_drag_size_stability.ron",

      "instructions": [
        "Window should appear on Monitor 1 (low-DPI)",
        "Drag the window back to Monitor 0 (high-DPI)",
        "Observe the window size after dragging"
      ],

      "success_criteria": {
        "without_workaround": "Window size shrinks (appears smaller than before)",
        "with_workaround": "Window size is preserved (same logical size, brief flash is OK)"
      }
    },

    {
      "id": "same_monitor_restore_mon1",
      "description": "Basic position/size persistence on Monitor 1",
      "automation": "full",
      "launch_monitor": 1,

      "ron_file": "same_monitor_restore_mon1.ron",

      "mutation": {
        "target_monitor": "launch",
        "position_offset": [300, 200],
        "size": [1100, 600]
      },

      "validate": ["position", "size", "monitor_index", "mode"]
    },

    {
      "id": "cross_low_to_high_W1",
      "description": "Window on high-DPI monitor restores correctly when launched from low-DPI monitor",
      "automation": "full",
      "launch_monitor": 1,
      "requires": {"min_monitors": 2, "different_scales": true},
      "workaround_keys": ["W1"],

      "workaround_validation": {
        "feature_flag": "workaround-macos-scale-compensation",
        "build_without": "--no-default-features --features workaround-winit-4341,workaround-bevy-22060",
        "build_with": "",
        "without_behavior": "Window restores to wrong position/size on Monitor 0 due to scale factor mismatch",
        "with_behavior": "Window restores to correct position/size on Monitor 0"
      },

      "ron_file": "cross_monitor_low_to_high.ron",

      "validate": ["position", "size", "monitor_index", "mode"]
    }
  ]
}
